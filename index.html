<!DOCTYPE html>
<html manifest="./websocket.manifest">
<head>
    <title>Qiddler 类Fiddler工具</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style>
        .container{
            display:-webkit-box;
            -webkit-box-orient:vertical;
        }
	ul,li{
		list-style:none;
		padding:0;
		margin:0;
	}

details{border: 1px solid #E1E1E1; border-radius: 5px; box-shadow: 0 1px 4px rgba(0, 0, 0, .4); color: #363636; margin: 0 0 .4em; padding: 1%;}
details[open]{background: #E1E1E1;}
summary{background: -webkit-linear-gradient(top, #FAFAFA 50%, #E1E1E1 50%); border-radius: 5px; cursor: pointer; font-size: .8em; font-weight: bold; margin: -1%; padding: 8px 0; position: relative; width: 102%;}
summary:hover,details[open] summary{background: #E1E1E1;}
summary::-webkit-details-marker{display: none}
summary:before{border-radius: 5px; content: "+"; color: #363636; display: block; float: left; font-size: 1.5em; font-weight: bold; margin: -2px 10px 0 10px; padding: 0; text-align: center; width: 20px;}
details[open] summary:before{content: "-"; margin-top: -4px;}
.rule-list{padding-top:12px;}
details ul{padding-top:12px;}
:indeterminate{
	background:rgba(23,44,55,.3);
	content:"0";
}

    </style>
</head>
<body>
<div class="container">
	<div id="eidtor">
		<label for="ruleType">类型</label>
		<select id="ruleType">
			<option value="1">simple host</option>
			<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
			<option value="3">local content replace(file)</option>
			<option value="4">local content replace(dir)</option>
			<option value="5">remote content repalce</option>
		</select>
		<label for="pattern">规则</label><input type="text" id="pattern" />
		<label for="replace">替换</label><input type="text" id="replace" />
		<button id="selectFile" style="display:none">getFile</button>
		<button id="selectDir" style="display:none">getDir</button>
		<button onclick="addRule(event)">add rule</button>
	</div>
	<ul id="ruleGroups">
		<li groupId="qp-my-center">
			<fieldset class="rule-group">
				<legend class="rule-group-name">Q+ 个人中心</legend>
				<ul class="rule-list">
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="2">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
				</ul>
			</fieldset>
		</li>
		<li>
			<details>
				<summary class="rule-group-name">Q+ 个人中心</summary>
				<ul class="rule-list">
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="2">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<details>
						<summary>cgi.qplus.com</summary>
						<ul>
							<li>
								<span contenteditable=true class="pattern">cgi/mycenter</span>
								<span contenteditable=true class="replace">172.34.35.220</span>
							</li>
							<li>
								<span contenteditable=true class="pattern">cgi/mycenter</span>
								<span contenteditable=true class="replace">172.34.35.220</span>
							</li>
						</ul>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
				</ul>
			</details>
		</li>
		<li>
			<details>
				<summary class="rule-group-name">Q+ 个人中心</summary>
				<ul class="rule-list">
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
					<li class="rule">
						<input type="checkbox" class="enabaled" />
						<select class="rule-type" value="host">
							<option value="1">simple host</option>
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
							<option value="3">local content replace(file)</option>
							<option value="4">local content replace(dir)</option>
							<option value="5">remote content repalce</option>
						</select>
						<span contenteditable=true class="pattern">cgi.qplus.com</span>
						<span contenteditable=true class="replace">172.34.35.220</span>
					</li>
				</ul>
			</details>
		</li>
	</ul>
</div>
<div id="debug">
    debug area<br/>
</div>
<script>
    function $(id){return document.getElementById(id);}
	window.onerror=function(a,b,c){alert('error'+a+b+c);}
    function init(){
        if(!!!window.App){
            window.App = {
                'doAction':function(type,msg){
					if(window.console){
						console.info("call App's doAction with args:",arguments);
					}
                },
                'getFile':function(){
                    return "C:\\fake\\file.html";
                },
                'getDir':function(){
                    return "C:\\fake";
                },
				'getRules':function(){},
                'ruleChanged':{'connect':function(){}}
            };
        }
		App.ruleChanged.connect(updateRule);
        $('ruleType').onchange=function(){
            if(this.value == 3){
                $('selectDir').style["display"]="none";
                $('selectFile').style["display"]="";
            }else if(this.value== 4){
                $('selectFile').style["display"]="none";
                $('selectDir').style["display"]="";
            }else{
                $('selectFile').style["display"]="none";
                $('selectDir').style["display"]="none";
            }
        }
        $('selectFile').onclick=function(){
            $('replace').value = App.getFile();
        }
        $('selectDir').onclick=function(){
            $('replace').value = App.getDir();
        }
        updateRule( App.getRules() );
		$('ruleGroups').addEventListener("keydown",function(e){
			if(e.keyCode==13){
				e.target.blur();
				if(e.target.getAttribute("ori-content") != e.target.innerHTML){
					onValueChange(e.target);
				}
				e.preventDefault();
			}
		},true);
		$('ruleGroups').addEventListener("mousedown",function(e){
			if(e.target.hasAttribute('contenteditable')){
				e.target.setAttribute("ori-content",e.target.innerHTML);
			}
		},true);
		
    }
	function onValueChange(el){
		if(window.console){
			console.info(el.innerHTML);
		}
	}
    function addRule(){
        var spliter = "\x01";
        var msg = [$('ruleType').value,$('pattern').value,$('replace').value].join(spliter);
        window.App.doAction("addRule",msg);
    }
    function updateRule(ruleGroup){
		var k=[];
		if(ruleGroup){
			for(var b in ruleGroup){
				k.push("---");
				k.push([b,ruleGroup[b]]);
			}
		}
        $('debug').innerHTML+="ruleChanged:"+k.join("|")+"<br/>";
    }
	
	var Model=function(){}
	Model.prototype={
		updaetRule:function(rule){
			
		},
		appendRule:function(rule){
			
		},
		appendGroup:function(group){
		
		}
	};
	
	var View=function(){}
	View.prototype={
		updateRule:function(rule){
			
		},
		appendRule:function(rule){
			
		},
		appendGroup:function(group){
			f = document.createFragment();
			/*
			<li groupId="qp-my-center">
				<fieldset class="rule-group">
					<legend class="rule-group-name">Q+ 个人中心</legend>
					<ul class="rule-list">
						<li class="rule">
							<input type="checkbox" class="enabaled" />
							<select class="rule-type" value="host">
								<option value="1">simple host</option>
								<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
								<option value="3">local content replace(file)</option>
								<option value="4">local content replace(dir)</option>
								<option value="5">remote content repalce</option>
							</select>
							<span contenteditable=true class="pattern">cgi.qplus.com</span>
							<span contenteditable=true class="replace">172.34.35.220</span>
						</li>
					</ul>
				</fieldset>
			</li>
			*/
			var template='\
					<li class="rule">\
						<input type="checkbox" class="enabaled" value="%groupEnabled%" />\
						<select class="rule-type" value="%groupType%">\
							<option value="1">simple host</option>\
							<option value="2" title="可以cgi路径为同一domain设置host">complex host</option>\
							<option value="3">local content replace(file)</option>\
							<option value="4">local content replace(dir)</option>\
							<option value="5">remote content repalce</option>\
						</select>\
						<span contenteditable=true class="pattern">%groupPattern%</span>\
						<span contenteditable=true class="replace">%groupReplace%</span>\
					</li>\
				';
			
			var group = document.createElement('li');
			group.id = group.groupId;
			
			group.innerHTML = "";
			
			$('ruleGroups').appendChild(group);
		}
	}
	
	var view=new View(),model=new Model();
    window.onload = init;
</script>


</body>
</html>
