<!DOCTYPE html>
<html manifest="./websocket.manifest">
<head>
    <title>Qiddler 类Fiddler工具</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style>
        .container{
            display:-webkit-box;
            -webkit-box-orient:horizontal;
        }
    </style>
</head>
<body>
<div class="container">
    <div>
    <label for="ruleType">类型</label><select id="ruleType">
        <option value="1">simple host</option>
        <option value="2" title="可以cgi路径为同一domain设置host">complex host</option>
        <option value="3">local content replace(file)</option>
        <option value="4">local content replace(dir)</option>
        <option value="5">remote content repalce</option>
    </select>
        <label for="pattern">规则</label><input type="text" id="pattern" />
        <label for="replace">替换</label><input type="text" id="replace" />
        <button id="selectFile" style="display:none">getFile</button>
        <button id="selectDir" style="display:none">getDir</button>
        <button onclick="addRule(event)">add rule</button>
    </div>
</div>
<div id="debug">
    debug area<br/>
</div>
<script>
    function $(id){return document.getElementById(id);}
    function init(){
        if(!!!window.App){
            window.App = {
                'doAction':function(type,msg){
                    console.info("call App's doAction with args:",arguments);
                },
                'getFile':function(){
                    return "C:\\fake\\file.html";
                },
                'getDir':function(){
                    return "C:\\fake";
                },
                'updateRule':{'connect':function(){}}
            };
        }
        App.ruleChanged.connect(updateRule);
        $('ruleType').onchange=function(){
            if(this.value == 3){
                $('selectDir').style["display"]="none";
                $('selectFile').style["display"]="";
            }else if(this.value== 4){
                $('selectFile').style["display"]="none";
                $('selectDir').style["display"]="";
            }else{
                $('selectFile').style["display"]="none";
                $('selectDir').style["display"]="none";
            }
        }
        $('selectFile').onclick=function(){
            $('replace').value = App.getFile();
        }
        $('selectDir').onclick=function(){
            $('replace').value = App.getDir();
        }
        updateRule( App.getRules() );
    }
    function addRule(){
        var spliter = "\x01";
        var msg = [$('ruleType').value,$('pattern').value,$('replace').value].join(spliter);
        window.App.doAction("addRule",msg);
    }
    function updateRule(ruleGroup){
        var k=[];
        for(var b in ruleGroup){
            k.push("---");
            k.push([b,ruleGroup[b]]);
        }
        $('debug').innerHTML+="ruleChanged:"+k.join("|")+"<br/>";
    }
    window.onload = init;
</script>


</body>
</html>
